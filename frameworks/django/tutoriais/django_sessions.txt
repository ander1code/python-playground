ğŸ“¦ Django Moderno â€“ SessÃµes (Sessions)

ğŸ” O que sÃ£o SessÃµes?

SessÃµes sÃ£o usadas para armazenar dados do usuÃ¡rio entre diferentes requisiÃ§Ãµes HTTP. Ao invÃ©s de salvar dados no 
navegador do cliente (como cookies), o Django salva as sessÃµes no lado do servidor (por padrÃ£o, no banco de dados), e o 
navegador armazena apenas um ID da sessÃ£o.

Isso aumenta a seguranÃ§a, jÃ¡ que dados sensÃ­veis nÃ£o sÃ£o visÃ­veis ou manipulÃ¡veis diretamente pelo cliente.

	âš™ï¸ Como configurar sessÃµes no Django moderno?

		No settings.py do seu projeto, verifique se as seguintes configuraÃ§Ãµes estÃ£o presentes:

			INSTALLED_APPS = [
				...
				'django.contrib.sessions',
				...
			]

			MIDDLEWARE = [
				...
				'django.contrib.sessions.middleware.SessionMiddleware',
				...
			]


	âœ… Estas opÃ§Ãµes jÃ¡ vÃªm habilitadas por padrÃ£o em projetos criados com django-admin startproject.

	ğŸ§ª Exemplo prÃ¡tico: Login com sessÃ£o
	
		Vamos criar um sistema de login simples que salva o nome de usuÃ¡rio na sessÃ£o ao fazer login, exibe a 
		pÃ¡gina de boas-vindas, e remove a sessÃ£o ao fazer logout.

	
		ğŸ“ 1. FormulÃ¡rio de Login (forms.py)

			from django import forms

			class LoginForm(forms.Form):
				username = forms.CharField(label="UsuÃ¡rio", max_length=100)


		ğŸ“„ 2. Views (views.py)

				from django.shortcuts import render, redirect
				from django.http import HttpResponse
				from .forms import LoginForm

				def login_view(request):
					if request.method == 'POST':
						form = LoginForm(request.POST)
						if form.is_valid():
							username = form.cleaned_data['username']
							request.session['username'] = username  # Salva na sessÃ£o
							return redirect('logged_in')
					else:
						form = LoginForm()
					return render(request, 'login.html', {'form': form})

				def form_view(request):
					username = request.session.get('username')
					if username:
						return render(request, 'loggedin.html', {'username': username})
					return redirect('login')

				def logout_view(request):
					request.session.pop('username', None)  # Remove da sessÃ£o
					return HttpResponse("<strong>VocÃª saiu com sucesso.</strong>")

		ğŸŒ 3. URLs (urls.py)
		
			from django.urls import path
			from . import views

			urlpatterns = [
				path('login/', views.login_view, name='login'),
				path('connection/', views.form_view, name='logged_in'),
				path('logout/', views.logout_view, name='logout'),
			]

		ğŸ§¾ 4. Templates

			ğŸ“„ login.html
			
				<!DOCTYPE html>
				<html lang="pt-br">
				<head>
					<meta charset="UTF-8">
					<title>Login</title>
				</head>
				<body>
					<h2>Login</h2>
					<form method="post">
						{% csrf_token %}
						{{ form.as_p }}
						<button type="submit">Entrar</button>
					</form>
				</body>
				</html>

			ğŸ“„ loggedin.html

				<!DOCTYPE html>
				<html lang="pt-br">
				<head>
					<meta charset="UTF-8">
					<title>Bem-vindo</title>
				</head>
				<body>
					<h2>OlÃ¡, {{ username }}!</h2>
					<p><a href="{% url 'logout' %}">Sair</a></p>
				</body>
				</html>

	ğŸ’¡ FunÃ§Ãµes Ãºteis com sessÃµes

	Django oferece alguns mÃ©todos extras para trabalhar com sessÃµes:

	# Define a expiraÃ§Ã£o da sessÃ£o para 5 minutos
	request.session.set_expiry(300)

	# Tempo restante em segundos
	tempo_restante = request.session.get_expiry_age()

	# Data/hora de expiraÃ§Ã£o
	data_expiracao = request.session.get_expiry_date()

	# Apaga sessÃµes expiradas do banco de dados
	from django.contrib.sessions.models import Session
	Session.objects.all().delete()  # ou Session.objects.clear_expired()

	# SessÃ£o expira ao fechar o navegador?
	expira_ao_fechar = request.session.get_expire_at_browser_close()

	ğŸ§¼ Onde o Django armazena sessÃµes?

	Por padrÃ£o:

	No banco de dados, na tabela django_session.

	Mas vocÃª pode mudar o backend da sessÃ£o no settings.py:

		SESSION_ENGINE = 'django.contrib.sessions.backends.db'         # padrÃ£o
		SESSION_ENGINE = 'django.contrib.sessions.backends.cache'      # em cache
		SESSION_ENGINE = 'django.contrib.sessions.backends.file'       # em arquivos
		SESSION_ENGINE = 'django.contrib.sessions.backends.signed_cookies'  # cookies assinados